<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - AiTracker</title>
    <link rel="stylesheet" href="/css/style.css">
    <style>
    /* Admin-specific styles that extend the main stylesheet */

    /* Sidebar styles */
    .sidebar {
        background: var(--color-gray-900);
        color: var(--color-white);
        width: 280px;
        position: fixed;
        height: 100vh;
        left: 0;
        top: 0;
        z-index: 100;
        display: flex;
        flex-direction: column;
    }

    .sidebar-header {
        padding: 24px;
        border-bottom: 1px solid var(--color-gray-700);
        text-align: center;
    }

    .sidebar-header h2 {
        margin: 0 0 4px 0;
        font-size: 18px;
        font-weight: 600;
    }

    .sidebar-header p {
        margin: 0;
        font-size: 14px;
        opacity: 0.8;
    }

    .sidebar-nav {
        flex: 1;
        padding: 16px 0;
    }

    .sidebar .nav-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px 24px;
        color: var(--color-gray-300);
        text-decoration: none;
        transition: all 0.15s ease;
        border: none;
        background: none;
        width: 100%;
        text-align: left;
        cursor: pointer;
        font-size: 14px;
        border-radius: var(--radius-md);
    }

    .sidebar .nav-item:hover {
        background: var(--color-gray-800);
        color: var(--color-white);
    }

    .sidebar .nav-item.active {
        background: var(--color-gray-800);
        color: var(--color-white);
        position: relative;
    }

    .sidebar .nav-item.active::before {
        content: '';
        position: absolute;
        left: 0;
        top: 50%;
        transform: translateY(-50%);
        width: 2px;
        height: 16px;
        background: var(--color-gray-400);
        border-radius: 0 1px 1px 0;
    }

    .sidebar .nav-icon {
        width: 20px;
        height: 20px;
        flex-shrink: 0;
    }

    .sidebar-footer {
        padding: 16px 24px;
        border-top: 1px solid var(--color-gray-700);
    }

    /* Main content styles */
    .main-content {
        margin-left: 280px;
        min-height: 100vh;
        background: var(--color-gray-50);
    }

    .top-header {
        background: var(--color-white);
        padding: 24px 32px;
        border-bottom: 1px solid var(--color-gray-200);
        box-shadow: var(--shadow-sm);
    }

    .page-title {
        display: flex;
        align-items: center;
        gap: 16px;
    }

    .page-icon {
        width: 40px;
        height: 40px;
        background: var(--color-gray-900);
        border-radius: var(--radius-lg);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
    }

    .page-title h1 {
        margin: 0;
        font-size: 28px;
        font-weight: 700;
        color: var(--color-gray-900);
    }

    .page-title p {
        margin: 0;
        color: var(--color-gray-600);
        font-size: 16px;
    }

    /* Content sections */
    .content-sections {
        padding: 32px;
    }

    .content-section {
        display: none;
        animation: fadeIn 0.3s ease;
    }

    .content-section.active {
        display: block;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    /* Section headers */
    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
    }

    .section-title {
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .section-icon {
        width: 32px;
        height: 32px;
        background: var(--color-gray-100);
        border-radius: var(--radius-md);
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--color-gray-700);
    }

    .section-title h2 {
        margin: 0;
        font-size: 24px;
        font-weight: 600;
        color: var(--color-gray-900);
    }

    /* Settings grid and cards */
    .settings-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 24px;
        margin-bottom: 32px;
    }

    .settings-card {
        background: var(--color-white);
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-sm);
        overflow: hidden;
    }

    .card-header {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 20px 24px;
        border-bottom: 1px solid var(--color-gray-200);
        background: var(--color-gray-50);
    }

    .card-icon {
        width: 24px;
        height: 24px;
        color: var(--color-gray-600);
    }

    .settings-card .card-header h3 {
        margin: 0;
        font-size: 18px;
        font-weight: 600;
        color: var(--color-gray-900);
    }

    .settings-card .form-group {
        margin-bottom: 16px;
    }

    .settings-card form {
        padding: 24px;
    }

    /* Data tables */
    .data-table-container {
        background: var(--color-white);
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-sm);
        overflow: hidden;
    }

    .data-table {
        width: 100%;
        border-collapse: collapse;
    }

    .data-table thead {
        background: var(--color-gray-50);
    }

    .data-table th {
        padding: 16px 20px;
        text-align: left;
        font-weight: 600;
        color: var(--color-gray-700);
        border-bottom: 1px solid var(--color-gray-200);
        font-size: 14px;
    }

    .data-table td {
        padding: 16px 20px;
        border-bottom: 1px solid var(--color-gray-100);
        font-size: 14px;
        color: var(--color-gray-600);
    }

    .data-table tbody tr:hover {
        background: var(--color-gray-50);
    }

    /* Role badges */
    .role-badge {
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 500;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .role-admin {
        background: var(--color-gray-100);
        color: var(--color-gray-800);
    }

    .role-agent {
        background: var(--color-gray-200);
        color: var(--color-gray-700);
    }

    .role-viewer {
        background: var(--color-gray-300);
        color: var(--color-gray-600);
    }

    /* Button styles */
    .btn-small {
        padding: 8px 16px;
        font-size: 12px;
        border-radius: 6px;
        border: none;
        cursor: pointer;
        font-weight: 500;
        transition: all 0.2s ease;
        display: inline-flex;
        align-items: center;
        gap: 6px;
    }

    .btn-edit {
        background: var(--color-gray-600);
        color: var(--color-white);
        border-radius: var(--radius-md);
    }

    .btn-edit:hover {
        background: var(--color-gray-700);
    }

    .btn-delete {
        background: var(--color-gray-700);
        color: var(--color-white);
        border-radius: var(--radius-md);
    }

    .btn-delete:hover {
        background: var(--color-gray-800);
    }

    /* Summary styles */
    .summary-controls {
        display: flex;
        gap: 16px;
        align-items: end;
        margin-bottom: 24px;
        background: var(--color-white);
        padding: 24px;
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-sm);
    }

    .summary-controls .form-group {
        margin-bottom: 0;
    }

    .summary-result {
        background: var(--color-white);
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-sm);
        overflow: hidden;
    }

    .summary-result .card-header {
        padding: 20px 24px;
        border-bottom: 1px solid var(--color-gray-200);
        background: var(--color-gray-50);
    }

    .summary-result .card-header h3 {
        margin: 0;
        font-size: 18px;
        font-weight: 600;
        color: var(--color-gray-900);
    }

    .summary-content {
        padding: 24px;
    }

    .summary-content pre {
        white-space: pre-wrap;
        line-height: 1.6;
        background: var(--color-gray-50);
        padding: 20px;
        border-radius: var(--radius-md);
        border-left: 4px solid var(--color-gray-400);
        margin: 0;
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-size: 14px;
        color: var(--color-gray-700);
    }

    /* Message styles */
    .success-message,
    .error-message {
        padding: 16px 20px;
        border-radius: 8px;
        margin-bottom: 24px;
        font-weight: 500;
        display: none;
    }

    .success-message {
        background: var(--color-gray-50);
        color: var(--color-gray-700);
        border: 1px solid var(--color-gray-200);
    }

    .error-message {
        background: var(--color-gray-100);
        color: var(--color-gray-800);
        border: 1px solid var(--color-gray-300);
    }

    /* Form enhancements */
    .form-section {
        margin-bottom: 24px;
    }

    .form-section-title {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 16px;
        font-weight: 600;
        color: var(--color-gray-800);
        margin-bottom: 16px;
        padding-bottom: 8px;
        border-bottom: 1px solid var(--color-gray-200);
    }

    .form-section-title svg {
        color: var(--color-gray-600);
    }

    /* Modal enhancements */
    .modal-content.large {
        max-width: 600px;
    }

    .modal-title-section {
        display: flex;
        align-items: center;
        gap: 16px;
        flex: 1;
    }

    .modal-icon {
        width: 48px;
        height: 48px;
        background: var(--color-gray-900);
        border-radius: var(--radius-lg);
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--color-white);
    }

    .modal-title {
        margin: 0;
        font-size: 24px;
        font-weight: 600;
        color: var(--color-gray-900);
    }

    .modal-subtitle {
        margin: 4px 0 0 0;
        color: var(--color-gray-600);
        font-size: 14px;
    }

    .modal-body {
        padding: 24px;
    }

    /* Responsive design */
    @media (max-width: 1024px) {
        .sidebar {
            width: 240px;
        }

        .main-content {
            margin-left: 240px;
        }

        .settings-grid {
            grid-template-columns: 1fr;
        }
    }

    @media (max-width: 768px) {
        .sidebar {
            transform: translateX(-100%);
        }

        .main-content {
            margin-left: 0;
        }

        .section-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 16px;
        }

        .summary-controls {
            flex-direction: column;
            align-items: stretch;
            gap: 12px;
        }

        .summary-controls .form-group {
            margin-bottom: 0;
        }

        .summary-controls .form-group:last-child {
            display: flex;
            justify-content: flex-end;
        }
    }

    /* Loading states */
    .loading {
        text-align: center;
        padding: 40px;
        color: var(--color-gray-500);
    }

    .loading::after {
        content: '';
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 2px solid var(--color-gray-300);
        border-radius: 50%;
        border-top-color: var(--color-gray-900);
        animation: spin 1s ease-in-out infinite;
        margin-left: 12px;
    }

    @keyframes spin {
        to { transform: rotate(360deg); }
    }

    /* API Documentation */
    .api-docs-content {
        max-width: none;
    }

    .api-section {
        margin-bottom: var(--space-8);
    }

    .api-section h3 {
        color: var(--color-gray-900);
        font-size: 18px;
        font-weight: 600;
        margin-bottom: var(--space-4);
        padding-bottom: var(--space-2);
        border-bottom: 1px solid var(--color-gray-200);
    }

    .api-endpoint {
        background: var(--color-white);
        border: 1px solid var(--color-gray-200);
        border-radius: var(--radius-lg);
        margin-bottom: var(--space-4);
        overflow: hidden;
    }

    .endpoint-header {
        display: flex;
        align-items: center;
        gap: var(--space-3);
        padding: var(--space-4);
        background: var(--color-gray-50);
        border-bottom: 1px solid var(--color-gray-200);
    }

    .method {
        padding: var(--space-1) var(--space-2);
        border-radius: var(--radius-md);
        font-size: 12px;
        font-weight: 600;
        text-transform: uppercase;
        min-width: 60px;
        text-align: center;
    }

    .method.get { background: var(--color-gray-600); color: white; }
    .method.post { background: var(--color-success); color: white; }
    .method.put { background: var(--color-warning); color: var(--color-gray-900); }
    .method.delete { background: var(--color-error); color: white; }

    .endpoint-url {
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-size: 14px;
        font-weight: 500;
        color: var(--color-gray-800);
    }

    .endpoint-description {
        margin: 0;
        padding: var(--space-4);
        color: var(--color-gray-600);
        font-size: 14px;
    }

    .api-example {
        padding: var(--space-4);
        border-top: 1px solid var(--color-gray-100);
    }

    .api-example h4 {
        margin: var(--space-3) 0 var(--space-2) 0;
        font-size: 14px;
        font-weight: 600;
        color: var(--color-gray-800);
    }

    .api-example pre {
        background: var(--color-gray-50);
        border: 1px solid var(--color-gray-200);
        border-radius: var(--radius-md);
        padding: var(--space-3);
        margin: 0;
        overflow-x: auto;
        font-size: 13px;
        line-height: 1.4;
    }

    .api-example code {
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        color: var(--color-gray-800);
    }
</style>
</head>
<body>
    <div class="app-layout">
        <!-- Modern Sidebar Navigation -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2>Admin Panel</h2>
                <p>System Management</p>
            </div>

            <nav class="sidebar-nav">
                <button class="nav-item active" data-section="ai-settings" id="ai-settings-nav">
                    <svg class="nav-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"></circle>
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                    </svg>
                    <span>AI Settings</span>
                </button>

                <button class="nav-item" data-section="daily-summary" id="daily-summary-nav">
                    <svg class="nav-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14,2 14,8 20,8"></polyline>
                    </svg>
                    <span>Daily Summary</span>
                </button>

                <button class="nav-item" data-section="categories" id="categories-nav">
                    <svg class="nav-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.83z"></path>
                        <line x1="7" y1="7" x2="7.01" y2="7"></line>
                    </svg>
                    <span>Categories</span>
                </button>

                <button class="nav-item" data-section="api-docs" id="api-docs-nav">
                    <svg class="nav-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14,2 14,8 20,8"></polyline>
                        <line x1="16" y1="13" x2="8" y2="13"></line>
                        <line x1="16" y1="17" x2="8" y2="17"></line>
                        <polyline points="10,9 9,9 8,9"></polyline>
                    </svg>
                    <span>API Reference</span>
                </button>

                <button class="nav-item" data-section="users" id="users-nav">
                    <svg class="nav-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                        <circle cx="12" cy="7" r="4"></circle>
                    </svg>
                    <span>User Management</span>
                </button>
            </nav>

            <div class="sidebar-footer">
                <button class="nav-item logout-btn" onclick="window.location.href='/'">
                    <svg class="nav-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 0 2-2h4"></path>
                        <polyline points="16,17 21,12 16,7"></polyline>
                        <line x1="21" y1="12" x2="9" y2="12"></line>
                    </svg>
                    <span>Back to Dashboard</span>
                </button>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="main-content">

            <!-- Top Header -->
            <header class="top-header">
                <div class="page-title">
                    <div class="page-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="3"></circle>
                            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                        </svg>
                    </div>
                    <div>
                        <h1 id="page-title">AI Settings</h1>
                        <p id="page-subtitle">Configure AI provider and feature settings</p>
                    </div>
                </div>
            </header>

            <!-- Content Sections -->
            <div class="content-sections">
                <!-- AI Settings Section -->
                <section id="ai-settings-section" class="content-section active">
                    <div id="settings-message" class="success-message" style="display: none;"></div>

                    <div class="settings-grid">
                        <div class="settings-card">
                            <div class="card-header">
                                <div class="card-icon">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="12" cy="12" r="3"></circle>
                                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                                    </svg>
                                </div>
                                <h3>AI Provider Configuration</h3>
                            </div>
                            <form id="ai-settings-form">
                                <div class="form-group">
                                    <label for="provider">AI Provider</label>
                                    <select id="provider" name="provider">
                                        <option value="grok">Grok (xAI)</option>
                                        <option value="openrouter">OpenRouter</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label for="api-key">API Key</label>
                                    <input type="password" id="api-key" name="api_key" placeholder="Enter API key">
                                    <small style="color: var(--color-gray-500);">API key is stored securely and encrypted</small>
                                </div>

                                <div class="form-group">
                                    <label for="model-name">Model Name</label>
                                    <input type="text" id="model-name" name="model_name" placeholder="e.g., grok-beta">
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="temperature">Temperature</label>
                                        <input type="number" id="temperature" name="temperature" min="0" max="2" step="0.1">
                                    </div>
                                    <div class="form-group">
                                        <label for="max-tokens">Max Tokens</label>
                                        <input type="number" id="max-tokens" name="max_tokens" min="1">
                                    </div>
                                </div>
                            </form>
                        </div>

                        <div class="settings-card">
                            <div class="card-header">
                                <div class="card-icon">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M9 12l2 2 4-4m6 2a9 9 0 1 1-18 0 9 9 0 0 1 18 0z"></path>
                                    </svg>
                                </div>
                                <h3>AI Features</h3>
                            </div>
                            <form id="ai-features-form">
                                <div class="checkbox-group">
                                    <input type="checkbox" id="categorization-enabled" name="categorization_enabled">
                                    <label for="categorization-enabled">Auto-categorization of requests</label>
                                </div>

                                <div class="checkbox-group">
                                    <input type="checkbox" id="replies-enabled" name="replies_enabled">
                                    <label for="replies-enabled">AI-generated replies</label>
                                </div>

                                <div class="checkbox-group">
                                    <input type="checkbox" id="summaries-enabled" name="summaries_enabled">
                                    <label for="summaries-enabled">Daily summary generation</label>
                                </div>

                                <div class="checkbox-group">
                                    <input type="checkbox" id="kb-enabled" name="kb_enabled">
                                    <label for="kb-enabled">Knowledge base AI improvements</label>
                                </div>

                                <button type="submit" class="btn-primary" style="margin-top: 20px;">Save AI Settings</button>
                            </form>
                        </div>
                    </div>
                </section>

                <!-- Daily Summary Section -->
                <section id="daily-summary-section" class="content-section">
                    <div class="summary-controls">
                        <div class="form-group">
                            <label for="summary-date">Select Date:</label>
                            <input type="date" id="summary-date" value="">
                        </div>
                        <div class="form-group" style="display: flex; align-items: end;">
                            <button id="generate-summary-btn" class="btn-primary">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M9 12l2 2 4-4m6 2a9 9 0 1 1-18 0 9 9 0 0 1 18 0z"></path>
                                </svg>
                                Generate Summary
                            </button>
                        </div>
                    </div>

                    <div id="summary-result" class="summary-result" style="display: none;">
                        <div class="card-header">
                            <div class="card-icon">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                    <polyline points="14,2 14,8 20,8"></polyline>
                                </svg>
                            </div>
                            <h3>Summary for <span id="summary-date-display"></span></h3>
                        </div>
                        <div id="summary-content" class="summary-content"></div>
                        <div class="form-actions">
                            <button id="copy-summary-btn" class="btn-secondary">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                                </svg>
                                Copy to Clipboard
                            </button>
                        </div>
                    </div>
                </section>

                <!-- Categories Management Section -->
                <section id="categories-section" class="content-section">
                    <div class="section-header">
                        <div class="section-title">
                            <div class="section-icon">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.83z"></path>
                                    <line x1="7" y1="7" x2="7.01" y2="7"></line>
                                </svg>
                            </div>
                            <h2>Category Management</h2>
                        </div>
                        <button id="add-category-btn" class="btn-primary">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                            Add Category
                        </button>
                    </div>

                    <div id="categories-message" class="success-message" style="display: none;"></div>

                    <div class="data-table-container">
                        <table class="data-table" id="categories-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Name</th>
                                    <th>Description</th>
                                    <th>Request Count</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="categories-tbody">
                                <tr>
                                    <td colspan="5" style="text-align: center;">Loading categories...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- User Management Section -->
                <section id="users-section" class="content-section">
                    <div class="section-header">
                        <div class="section-title">
                            <div class="section-icon">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                    <circle cx="12" cy="7" r="4"></circle>
                                </svg>
                            </div>
                            <h2>User Management</h2>
                        </div>
                        <button id="add-user-btn" class="btn-primary">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                            Add User
                        </button>
                    </div>

                    <div id="users-message" class="success-message" style="display: none;"></div>

                    <div class="data-table-container">
                        <table class="data-table" id="users-table">
                            <thead>
                                <tr>
                                    <th>Username</th>
                                    <th>Email</th>
                                    <th>Role</th>
                                    <th>Created</th>
                                    <th class="actions-column">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="users-tbody">
                                <tr>
                                    <td colspan="5" style="text-align: center; padding: 40px;">Loading users...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>
            </div>
        </main>

    <!-- Add/Edit User Modal -->
    <div id="user-modal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <div class="modal-title-section">
                    <div class="modal-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                    </div>
                    <div>
                        <h3 class="modal-title" id="user-modal-title">Add User</h3>
                        <p class="modal-subtitle">Create a new user account or edit existing user details</p>
                    </div>
                </div>
                <button class="modal-close">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <form id="user-form">
                    <div class="form-grid">
                        <div class="form-section">
                            <h4 class="form-section-title">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                    <circle cx="12" cy="7" r="4"></circle>
                                </svg>
                                User Information
                            </h4>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="user-username">Username *</label>
                                    <input type="text" id="user-username" name="username" placeholder="Enter username" required>
                                </div>
                                <div class="form-group">
                                    <label for="user-email">Email Address *</label>
                                    <input type="email" id="user-email" name="email" placeholder="user@example.com" required>
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h4 class="form-section-title">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                                    <circle cx="12" cy="16" r="1"></circle>
                                    <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                                </svg>
                                Access Control
                            </h4>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="user-password">Password *</label>
                                    <input type="password" id="user-password" name="password" placeholder="Enter secure password" required>
                                </div>
                                <div class="form-group">
                                    <label for="user-role">User Role *</label>
                                    <select id="user-role" name="role" required>
                                        <option value="">Select User Role</option>
                                        <option value="admin">üëë Administrator - Full system access</option>
                                        <option value="agent">üë®‚Äçüíº Support Agent - Handle requests & KB</option>
                                        <option value="viewer">üëÅÔ∏è Viewer - Read-only access</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn-secondary" onclick="closeModal()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="18" y1="6" x2="6" y2="18"></line>
                                <line x1="6" y1="6" x2="18" y2="18"></line>
                            </svg>
                            Cancel
                        </button>
                        <button type="submit" class="btn-primary">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                <polyline points="14,2 14,8 20,8"></polyline>
                            </svg>
                            Save User
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

                <!-- API Documentation Section -->
                <section id="api-docs-section" class="content-section">
                    <div class="section-header">
                        <div class="section-title">
                            <div class="section-icon">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                    <polyline points="14,2 14,8 20,8"></polyline>
                                    <line x1="16" y1="13" x2="8" y2="13"></line>
                                    <line x1="16" y1="17" x2="8" y2="17"></line>
                                    <polyline points="10,9 9,9 8,9"></polyline>
                                </svg>
                            </div>
                            <h2>API Reference</h2>
                            <p>Complete API documentation with sample payloads for integration</p>
                        </div>
                    </div>

                    <div class="api-docs-content">
                        <div class="api-section">
                            <h3>üîê Authentication APIs</h3>

                            <div class="api-endpoint">
                                <div class="endpoint-header">
                                    <span class="method post">POST</span>
                                    <span class="endpoint-url">/api/auth/login</span>
                                </div>
                                <p class="endpoint-description">Authenticate user and get session token</p>

                                <div class="api-example">
                                    <h4>Request Body:</h4>
                                    <pre><code>{
  "username": "admin",
  "password": "yourpassword"
}</code></pre>

                                    <h4>Response:</h4>
                                    <pre><code>{
  "user": {
    "id": 1,
    "username": "admin",
    "email": "admin@example.com",
    "role": "admin"
  }
}</code></pre>
                                </div>
                            </div>

                            <div class="api-endpoint">
                                <div class="endpoint-header">
                                    <span class="method get">GET</span>
                                    <span class="endpoint-url">/api/auth/me</span>
                                </div>
                                <p class="endpoint-description">Get current authenticated user info</p>

                                <div class="api-example">
                                    <h4>Response:</h4>
                                    <pre><code>{
  "user": {
    "id": 1,
    "username": "admin",
    "role": "admin"
  }
}</code></pre>
                                </div>
                            </div>
                        </div>

                        <div class="api-section">
                            <h3>üìã Support Requests APIs</h3>

                            <div class="api-endpoint">
                                <div class="endpoint-header">
                                    <span class="method get">GET</span>
                                    <span class="endpoint-url">/api/requests</span>
                                </div>
                                <p class="endpoint-description">Get all support requests with optional filtering</p>

                                <div class="api-example">
                                    <h4>Query Parameters:</h4>
                                    <pre><code>?status=open&limit=50&offset=0</code></pre>

                                    <h4>Response:</h4>
                                    <pre><code>[
  {
    "id": 1,
    "requester_name": "John Doe",
    "channel": "email",
    "description": "Issue with login",
    "status": "open",
    "severity": "medium",
    "created_at": "2024-01-01T10:00:00Z"
  }
]</code></pre>
                                </div>
                            </div>

                            <div class="api-endpoint">
                                <div class="endpoint-header">
                                    <span class="method post">POST</span>
                                    <span class="endpoint-url">/api/requests</span>
                                </div>
                                <p class="endpoint-description">Create new support request (agents only)</p>

                                <div class="api-example">
                                    <h4>Request Body:</h4>
                                    <pre><code>{
  "requester_name": "Jane Smith",
  "channel": "web",
  "category_id": 1,
  "severity": "high",
  "description": "Cannot access dashboard"
}</code></pre>
                                </div>
                            </div>

                            <div class="api-endpoint">
                                <div class="endpoint-header">
                                    <span class="method post">POST</span>
                                    <span class="endpoint-url">/api/requests/teams/create</span>
                                </div>
                                <p class="endpoint-description">Create request from Microsoft Teams message</p>

                                <div class="api-example">
                                    <h4>Request Body:</h4>
                                    <pre><code>{
  "message": "Help! Login not working",
  "userName": "john.doe",
  "userId": "teams-user-123",
  "channelId": "teams-channel-456",
  "teamId": "teams-team-789",
  "channelName": "General",
  "teamName": "IT Support"
}</code></pre>
                                </div>
                            </div>
                        </div>

                        <div class="api-section">
                            <h3>üìä Dashboard APIs</h3>

                            <div class="api-endpoint">
                                <div class="endpoint-header">
                                    <span class="method get">GET</span>
                                    <span class="endpoint-url">/api/dashboard/metrics</span>
                                </div>
                                <p class="endpoint-description">Get dashboard metrics (total, today, status counts)</p>

                                <div class="api-example">
                                    <h4>Response:</h4>
                                    <pre><code>{
  "total": 150,
  "todayCount": 5,
  "statusCounts": {
    "open": 45,
    "in_progress": 12,
    "closed": 93
  }
}</code></pre>
                                </div>
                            </div>

                            <div class="api-endpoint">
                                <div class="endpoint-header">
                                    <span class="method get">GET</span>
                                    <span class="endpoint-url">/api/dashboard/export/csv</span>
                                </div>
                                <p class="endpoint-description">Export requests data to CSV file</p>

                                <div class="api-example">
                                    <h4>Query Parameters:</h4>
                                    <pre><code>?startDate=2024-01-01&endDate=2024-01-31&status=all</code></pre>

                                    <h4>Response:</h4>
                                    <pre><code>Content-Type: text/csv
Content-Disposition: attachment; filename="support_requests.csv"</code></pre>
                                </div>
                            </div>
                        </div>

                        <div class="api-section">
                            <h3>üß† Knowledge Base APIs</h3>

                            <div class="api-endpoint">
                                <div class="endpoint-header">
                                    <span class="method get">GET</span>
                                    <span class="endpoint-url">/api/kb</span>
                                </div>
                                <p class="endpoint-description">Get all knowledge base articles</p>

                                <div class="api-example">
                                    <h4>Query Parameters:</h4>
                                    <pre><code>?category=1&search=login&limit=20</code></pre>
                                </div>
                            </div>

                            <div class="api-endpoint">
                                <div class="endpoint-header">
                                    <span class="method post">POST</span>
                                    <span class="endpoint-url">/api/kb</span>
                                </div>
                                <p class="endpoint-description">Create new knowledge base article (agents only)</p>

                                <div class="api-example">
                                    <h4>Request Body:</h4>
                                    <pre><code>{
  "problem_summary": "Password reset issue",
  "solution": "Go to login page and click 'Forgot Password'",
  "category_id": 1,
  "tags": ["password", "login", "reset"]
}</code></pre>
                                </div>
                            </div>
                        </div>

                        <div class="api-section">
                            <h3>‚öôÔ∏è Admin APIs</h3>

                            <div class="api-endpoint">
                                <div class="endpoint-header">
                                    <span class="method get">GET</span>
                                    <span class="endpoint-url">/api/admin/users</span>
                                </div>
                                <p class="endpoint-description">Get all users (admin only)</p>

                                <div class="api-example">
                                    <h4>Response:</h4>
                                    <pre><code>[
  {
    "id": 1,
    "username": "admin",
    "email": "admin@example.com",
    "role": "admin",
    "created_at": "2024-01-01T00:00:00Z"
  }
]</code></pre>
                                </div>
                            </div>

                            <div class="api-endpoint">
                                <div class="endpoint-header">
                                    <span class="method put">PUT</span>
                                    <span class="endpoint-url">/api/admin/ai-settings</span>
                                </div>
                                <p class="endpoint-description">Update AI configuration (admin only)</p>

                                <div class="api-example">
                                    <h4>Request Body:</h4>
                                    <pre><code>{
  "provider": "openai",
  "api_key": "sk-...",
  "model_name": "gpt-4",
  "categorization_enabled": true,
  "replies_enabled": true,
  "temperature": 0.7
}</code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

    <script>
        let currentUserId = null;

        // Navigation switching
        document.querySelectorAll('.nav-item[data-section]').forEach(navItem => {
            navItem.addEventListener('click', () => {
                const section = navItem.getAttribute('data-section');
                switchAdminSection(section);
            });
        });

        function switchAdminSection(sectionName) {
            // Update navigation
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            document.querySelector(`[data-section="${sectionName}"]`).classList.add('active');

            // Update content sections
            document.querySelectorAll('.content-section').forEach(section => section.classList.remove('active'));
            document.getElementById(sectionName + '-section').classList.add('active');

            // Update page title
            const titles = {
                'ai-settings': { title: 'AI Settings', subtitle: 'Configure AI provider and feature settings' },
                'daily-summary': { title: 'Daily Summary', subtitle: 'Generate and view daily support reports' },
                'categories': { title: 'Categories', subtitle: 'Manage support request categories' },
                'api-docs': { title: 'API Reference', subtitle: 'Complete API documentation with sample payloads' },
                'users': { title: 'User Management', subtitle: 'Manage system users and permissions' }
            };

            const titleData = titles[sectionName];
            document.getElementById('page-title').textContent = titleData.title;
            document.getElementById('page-subtitle').textContent = titleData.subtitle;

            // Load section data
            if (sectionName === 'ai-settings') {
                loadAISettings();
            } else if (sectionName === 'daily-summary') {
                // Daily summary doesn't need initial loading
            } else if (sectionName === 'categories') {
                loadCategories();
            } else if (sectionName === 'users') {
                loadUsers();
            }
        }

        // AI Settings
        async function loadAISettings() {
            try {
                const response = await fetch('/api/admin/ai-settings');
                const settings = await response.json();

                document.getElementById('provider').value = settings.provider || 'grok';
                document.getElementById('model-name').value = settings.model_name || '';
                document.getElementById('temperature').value = settings.temperature || 0.7;
                document.getElementById('max-tokens').value = settings.max_tokens || 1000;

                document.getElementById('categorization-enabled').checked = settings.categorization_enabled;
                document.getElementById('replies-enabled').checked = settings.replies_enabled;
                document.getElementById('summaries-enabled').checked = settings.summaries_enabled;
                document.getElementById('kb-enabled').checked = settings.kb_enabled;
            } catch (error) {
                console.error('Failed to load AI settings:', error);
                showSettingsMessage('Failed to load AI settings', 'error');
            }
        }

        document.getElementById('ai-features-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            const formData = new FormData(document.getElementById('ai-settings-form'));
            const featuresData = new FormData(e.target);

            const settingsData = {
                provider: formData.get('provider'),
                api_key: formData.get('api_key'),
                model_name: formData.get('model_name'),
                temperature: parseFloat(formData.get('temperature')),
                max_tokens: parseInt(formData.get('max_tokens')),
                categorization_enabled: document.getElementById('categorization-enabled').checked,
                replies_enabled: document.getElementById('replies-enabled').checked,
                summaries_enabled: document.getElementById('summaries-enabled').checked,
                kb_enabled: document.getElementById('kb-enabled').checked
            };

            try {
                const response = await fetch('/api/admin/ai-settings', {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(settingsData)
                });

                if (response.ok) {
                    showSettingsMessage('AI settings saved successfully! API key configured.', 'success');
                    // Show confirmation that API key was saved
                    const apiKeyField = document.getElementById('api-key');
                    if (apiKeyField.value) {
                        // Show last 4 characters as confirmation
                        const masked = '‚Ä¢'.repeat(Math.max(0, apiKeyField.value.length - 4)) + apiKeyField.value.slice(-4);
                        showSettingsMessage(`API key saved: ...${masked}`, 'success');
                        // Clear after showing confirmation
                        setTimeout(() => {
                            apiKeyField.value = '';
                        }, 2000);
                    }
                    // Reload settings to verify they were saved
                    setTimeout(() => {
                        loadAISettings();
                    }, 1000);
                } else {
                    const error = await response.json();
                    showSettingsMessage(error.error || 'Failed to save AI settings', 'error');
                }
            } catch (error) {
                console.error('Failed to save AI settings:', error);
                showSettingsMessage('Failed to save AI settings', 'error');
            }
        });

        function showSettingsMessage(message, type) {
            const messageDiv = document.getElementById('settings-message');
            messageDiv.textContent = message;
            messageDiv.className = type + '-message';
            messageDiv.style.display = 'block';

            setTimeout(() => {
                messageDiv.style.display = 'none';
            }, 5000);
        }

        // User Management
        async function loadUsers() {
            try {
                const response = await fetch('/api/admin/users');
                const users = await response.json();

                renderUsers(users);
            } catch (error) {
                console.error('Failed to load users:', error);
                document.getElementById('users-tbody').innerHTML = '<tr><td colspan="5" style="text-align: center; color: red;">Failed to load users</td></tr>';
            }
        }

        function renderUsers(users) {
            if (!users || users.length === 0) {
                document.getElementById('users-tbody').innerHTML = '<tr><td colspan="5" style="text-align: center;">No users found</td></tr>';
                return;
            }

            document.getElementById('users-tbody').innerHTML = users.map(user => `
                <tr>
                    <td>${user.username}</td>
                    <td>${user.email}</td>
                    <td><span class="role-badge role-${user.role}">${user.role}</span></td>
                    <td>${new Date(user.created_at).toLocaleDateString()}</td>
                    <td>
                        <button class="btn-small btn-edit" onclick="editUser(${user.id})">Edit</button>
                        <button class="btn-small btn-delete" onclick="deleteUser(${user.id}, '${user.username}')">Delete</button>
                    </td>
                </tr>
            `).join('');
        }

        document.getElementById('add-user-btn').addEventListener('click', () => openUserModal());

        function openUserModal(userId = null) {
            currentUserId = userId;
            document.getElementById('user-modal-title').textContent = userId ? 'Edit User' : 'Add User';

            if (userId) {
                // Load user data for editing
                loadUserForEdit(userId);
            } else {
                document.getElementById('user-form').reset();
                document.getElementById('user-password').required = true;
            }

            document.getElementById('user-modal').classList.add('show');
        }

        async function loadUserForEdit(userId) {
            try {
                // This would need a GET endpoint for single user
                // For now, we'll implement it differently
                const response = await fetch('/api/admin/users');
                const users = await response.json();
                const user = users.find(u => u.id == userId);

                if (user) {
                    document.getElementById('user-username').value = user.username;
                    document.getElementById('user-email').value = user.email;
                    document.getElementById('user-role').value = user.role;
                    document.getElementById('user-password').required = false;
                    document.getElementById('user-password').placeholder = 'Leave blank to keep current password';
                }
            } catch (error) {
                console.error('Failed to load user for edit:', error);
            }
        }

        function editUser(userId) {
            openUserModal(userId);
        }

        async function deleteUser(userId, username) {
            if (!confirm(`Are you sure you want to delete user "${username}"?`)) {
                return;
            }

            try {
                const response = await fetch(`/api/admin/users/${userId}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    showUsersMessage('User deleted successfully', 'success');
                    loadUsers();
                } else {
                    const error = await response.json();
                    showUsersMessage(error.error || 'Failed to delete user', 'error');
                }
            } catch (error) {
                console.error('Failed to delete user:', error);
                showUsersMessage('Failed to delete user', 'error');
            }
        }

        document.getElementById('user-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            const formData = new FormData(e.target);
            const userData = {
                username: formData.get('username'),
                email: formData.get('email'),
                password: formData.get('password'),
                role: formData.get('role')
            };

            const method = currentUserId ? 'PUT' : 'POST';
            const url = currentUserId ? `/api/admin/users/${currentUserId}` : '/api/admin/users';

            try {
                const response = await fetch(url, {
                    method: method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(userData)
                });

                if (response.ok) {
                    closeModal();
                    showUsersMessage(`User ${currentUserId ? 'updated' : 'created'} successfully`, 'success');
                    loadUsers();
                } else {
                    const error = await response.json();
                    showUsersMessage(error.error || `Failed to ${currentUserId ? 'update' : 'create'} user`, 'error');
                }
            } catch (error) {
                console.error(`Failed to ${currentUserId ? 'update' : 'create'} user:`, error);
                showUsersMessage(`Failed to ${currentUserId ? 'update' : 'create'} user`, 'error');
            }
        });

        function showUsersMessage(message, type) {
            const messageDiv = document.getElementById('users-message');
            messageDiv.textContent = message;
            messageDiv.className = type + '-message';
            messageDiv.style.display = 'block';

            setTimeout(() => {
                messageDiv.style.display = 'none';
            }, 5000);
        }

        // Modal close
        document.querySelectorAll('.modal-close').forEach(closeBtn => {
            closeBtn.addEventListener('click', closeModal);
        });

        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) closeModal();
            });
        });

        function closeModal() {
            document.querySelectorAll('.modal').forEach(modal => {
                modal.classList.remove('show');
            });
            currentUserId = null;
        }

        // Daily Summary
        document.getElementById('generate-summary-btn').addEventListener('click', generateDailySummary);

        async function generateDailySummary() {
            const date = document.getElementById('summary-date').value;
            const resultDiv = document.getElementById('summary-result');
            const contentDiv = document.getElementById('summary-content');
            const dateDisplay = document.getElementById('summary-date-display');

            try {
                const response = await fetch(`/api/dashboard/daily-summary/${date}`);

                if (response.ok) {
                    const data = await response.json();
                    dateDisplay.textContent = new Date(date).toLocaleDateString();
                    contentDiv.innerHTML = `<pre>${data.summary}</pre>`;
                    resultDiv.style.display = 'block';
                } else {
                    contentDiv.innerHTML = '<p class="error">Failed to generate summary. AI may not be configured.</p>';
                    resultDiv.style.display = 'block';
                }
            } catch (error) {
                console.error('Failed to generate summary:', error);
                contentDiv.innerHTML = '<p class="error">Network error. Please try again.</p>';
                resultDiv.style.display = 'block';
            }
        }

        document.getElementById('copy-summary-btn').addEventListener('click', () => {
            const content = document.getElementById('summary-content').textContent;
            navigator.clipboard.writeText(content).then(() => {
                alert('Summary copied to clipboard!');
            });
        });

        // Category Management Functions
        async function loadCategories() {
            try {
                const response = await fetch('/api/dashboard/categories');
                const categories = await response.json();

                renderCategories(categories);
            } catch (error) {
                console.error('Failed to load categories:', error);
                document.getElementById('categories-tbody').innerHTML =
                    '<tr><td colspan="5" style="text-align: center; color: red;">Failed to load categories</td></tr>';
            }
        }

        function renderCategories(categories) {
            if (!categories || categories.length === 0) {
                document.getElementById('categories-tbody').innerHTML =
                    '<tr><td colspan="5" style="text-align: center;">No categories found</td></tr>';
                return;
            }

            document.getElementById('categories-tbody').innerHTML = categories.map(category => `
                <tr>
                    <td>${category.id}</td>
                    <td>${category.name}</td>
                    <td>${category.description || ''}</td>
                    <td>${category.count || 0}</td>
                    <td>
                        <button class="btn-small btn-edit" onclick="editCategory(${category.id}, '${category.name.replace(/'/g, "\\'")}', '${(category.description || '').replace(/'/g, "\\'")}')">Edit</button>
                        <button class="btn-small btn-delete" onclick="deleteCategory(${category.id}, '${category.name.replace(/'/g, "\\'")}')">Delete</button>
                    </td>
                </tr>
            `).join('');
        }

        document.getElementById('add-category-btn').addEventListener('click', () => {
            openCategoryModal();
        });

        function openCategoryModal(categoryId = null, name = '', description = '') {
            const modal = document.getElementById('category-modal') || createCategoryModal();
            document.getElementById('category-modal-title').textContent = categoryId ? 'Edit Category' : 'Add Category';
            document.getElementById('category-name').value = name;
            document.getElementById('category-description').value = description;

            window.currentCategoryId = categoryId;
            modal.classList.add('show');
        }

        function createCategoryModal() {
            const modal = document.createElement('div');
            modal.id = 'category-modal';
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content large">
                    <div class="modal-header">
                        <div class="modal-title-section">
                            <div class="modal-icon">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.83z"></path>
                                    <line x1="7" y1="7" x2="7.01" y2="7"></line>
                                </svg>
                            </div>
                            <div>
                                <h3 class="modal-title" id="category-modal-title">Add Category</h3>
                                <p class="modal-subtitle">Create a new support request category</p>
                            </div>
                        </div>
                        <button class="modal-close">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="18" y1="6" x2="6" y2="18"></line>
                                <line x1="6" y1="6" x2="18" y2="18"></line>
                            </svg>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form id="category-form">
                            <div class="form-section">
                                <h4 class="form-section-title">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.83z"></path>
                                        <line x1="7" y1="7" x2="7.01" y2="7"></line>
                                    </svg>
                                    Category Details
                                </h4>
                                <div class="form-group">
                                    <label for="category-name">Category Name *</label>
                                    <input type="text" id="category-name" name="name" placeholder="Enter category name" required>
                                </div>
                                <div class="form-group">
                                    <label for="category-description">Description</label>
                                    <textarea id="category-description" name="description" rows="3" placeholder="Describe what this category is for"></textarea>
                                </div>
                            </div>
                            <div class="form-actions">
                                <button type="button" class="btn-secondary" onclick="closeModal()">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <line x1="18" y1="6" x2="6" y2="18"></line>
                                        <line x1="6" y1="6" x2="18" y2="18"></line>
                                    </svg>
                                    Cancel
                                </button>
                                <button type="submit" class="btn-primary">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                        <polyline points="14,2 14,8 20,8"></polyline>
                                    </svg>
                                    Save Category
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);

            // Add form submission handler
            document.getElementById('category-form').addEventListener('submit', handleCategorySubmit);

            return modal;
        }

        async function handleCategorySubmit(e) {
            e.preventDefault();

            const formData = new FormData(e.target);
            const categoryData = {
                name: formData.get('name'),
                description: formData.get('description')
            };

            try {
                const method = window.currentCategoryId ? 'PUT' : 'POST';
                const url = window.currentCategoryId ?
                    `/api/admin/categories/${window.currentCategoryId}` :
                    '/api/admin/categories';

                const response = await fetch(url, {
                    method: method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(categoryData)
                });

                if (response.ok) {
                    closeModal();
                    showCategoriesMessage(`Category ${window.currentCategoryId ? 'updated' : 'created'} successfully!`, 'success');
                    loadCategories();
                } else {
                    const error = await response.json();
                    showCategoriesMessage(error.error || 'Failed to save category', 'error');
                }
            } catch (error) {
                console.error('Failed to save category:', error);
                showCategoriesMessage('Failed to save category', 'error');
            }
        }

        function editCategory(id, name, description) {
            openCategoryModal(id, name, description);
        }

        async function deleteCategory(id, name) {
            if (!confirm(`Are you sure you want to delete the category "${name}"? This may affect existing requests.`)) {
                return;
            }

            try {
                const response = await fetch(`/api/admin/categories/${id}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    showCategoriesMessage('Category deleted successfully!', 'success');
                    loadCategories();
                } else {
                    const error = await response.json();
                    showCategoriesMessage(error.error || 'Failed to delete category', 'error');
                }
            } catch (error) {
                console.error('Failed to delete category:', error);
                showCategoriesMessage('Failed to delete category', 'error');
            }
        }

        function showCategoriesMessage(message, type) {
            const messageDiv = document.getElementById('categories-message');
            messageDiv.textContent = message;
            messageDiv.className = type + '-message';
            messageDiv.style.display = 'block';

            setTimeout(() => {
                messageDiv.style.display = 'none';
            }, 5000);
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            // Set default section
            switchAdminSection('ai-settings');

            // Set default date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('summary-date').value = today;
        });
    </script>
</body>
</html>
